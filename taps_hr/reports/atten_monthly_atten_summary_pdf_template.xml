<?xml version="1.0" encoding="UTF-8"?>
<odoo>
   <template id="monthly_atten_summary_pdf_template">
       <t t-call="web.html_container">

        <t t-call="web.external_layout">

            <div class="page">
                <h4 class="text-right">
                    <strong>
                       Monthly Attendance Summary 
                       <span t-esc="month[0]"/>
                    </strong>
                </h4>
                <div class="container">
                    <div class="row justify-content-end">
                        <div class="col-6 table-sm table-bordered" style="font-size:11px;">
                            <center>
                                <strong>
                                    <u>Flag Defination</u>
                                </strong>
                            </center>
                            <!--<br/>-->
                            <div class="row">
                                <div class="col-4">
                                    <span class="small">P=Present</span>
                                    <br/>
                                    <span class="small">A=Absent</span>
                                    <br/>
                                    <span class="small">L=Late</span>
                                    <br/>
                                    <span class="small">R=Resigned</span>
                                    <br/>
                                    <span class="small">X=Not Yet Joined</span>
                                    <br/>
                                    <span class="small">H=Holiday</span>
                                    <br/>
                                </div>
                                <div class="col-4">
                                    <span class="small">F=Friday</span>
                                    <br/>
                                    <span class="small">OD=Outside Duty</span>
                                    <br/>
                                    <span class="small">TO=Timely Out</span>
                                    <br/>
                                    <span class="small">LW=Leave Without Pay</span>
                                    <br/>
                                    <span class="small">PO=Pending Out</span>
                                    <br/>
                                    <span class="small">EO=Early Out</span>
                                    <br/>
                                </div>
                                <div class="col-4">
                                    <span class="small">CL=Casual Leave</span>
                                    <br/>
                                    <span class="small">SL=Sick Leave</span>
                                    <br/>
                                    <span class="small">EL=Earn Leave</span>
                                    <br/>
                                    <span class="small">HP=Holiday Present</span>
                                    <br/>
                                    <span class="small">AJ=Adjustment Days</span>
                                    <br/>
                                    <span class="small">CO=Compensatory Off</span>
                                    <br/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <t t-foreach="dpt" t-as="dp">
                  <t t-set="total_dep_employee" t-value="0"/>
                    

                    <t t-foreach="sec.filtered(lambda x: (x.parent_id.id == dp.id))" t-as="se">
                       <t t-set="total_sec_employee" t-value="0"/>
                        <div class="container">
                        <!--<div class="row">-->
                        <div style="font-size: 12px;">
                            <strong>DEPARTMENT:</strong>
                            <span t-esc="dp.name" style="color:  #cc7000"/>
                        </div>
                        <!--</div>-->
                      </div>
                        <div class="container">
                            <!--<div class="row">-->
                            <div style="font-size: 12px;">
                                <strong>SECTION:</strong>
                                <span t-esc="se.name" style="color:  #cc7000"/>
                            </div>
                            <!--</div>-->
                        </div>
                        <br/>

                        <!--<div class="container">-->
                        <!--   <div class="row">-->
                        <!--      <div class="col-6">-->
                        <!--         <div class="row">-->
                        <!--            <div>-->
                        <!--               <strong>DEPARTMENT:</strong>-->
                        <!--               <span t-esc="emp[5]"/>-->
                        <!--            </div>-->
                        <!--         </div>-->
                        <!--         <div class="row">-->
                        <!--            <div>-->
                        <!--               <strong>SECTION:</strong>-->
                        <!--               <span t-esc="emp[6]"/>-->
                        <!--            </div>-->
                        <!--         </div>-->
                        <!--         <div class="row">-->
                        <!--            <div>-->
                        <!--               <strong>EMPLOYEE CATEGORY:</strong>-->
                        <!--               <span t-esc="emp[7]"/>-->
                        <!--            </div>-->
                        <!--         </div>-->
                        <!--      </div>-->
                        <!--   </div>-->
                        <!--</div>-->

                        <div class="container">

                            <t t-foreach="datas" t-as="emp">
                               
                                <t t-if="emp[9] == se.id">
                                <t t-set="total_dep_employee" t-value="total_dep_employee+1"/>
                                 <t t-set="total_sec_employee" t-value="total_sec_employee+1"/>
                                    <table class="table table-sm p-0 m-0" style="font-size:7px; table-layout:fixed; page-break-inside: avoid;">
                                        <thead>
                                            <!--<tr align="center" style="background-color:#E2E2E2;" t-foreach="alldays" t-as="ald">-->
                                            <tr align="center" style="background-color:orange;">
                                                <th>Code</th>
                                                <th colspan="3">
                                                    <center>Emloyee Name</center>
                                                </th>
                                                <th colspan="3">Designation</th>
                                                <t t-foreach="alldays" t-as="ald">
                                                    <t t-foreach="docs.filtered(lambda x: (x.attDate == ald[0]) and (x.employee_id.id == emp[2]))" t-as="att" style="border: 1pt solid black;border-collapse:separate;">
                                                        <th>
                                                            <span t-esc="att.attDate.strftime('%d')"/>
                                                            <br/>
                                                            <span t-esc="att.attDate.strftime('%b')"/>
                                                        </th>
                                                    </t>
                                                </t>
                                                <th>P/TO</th>
                                                <th>L/EO</th>
                                                <th>A/PO</th>
                                            </tr>
                                            <!--</tr>-->
                                        </thead>
                                        <tbody>
                                            
                                            <t t-set="p" t-value="0"/>
                                            <t t-set="to" t-value="0"/>
                                            <t t-set="l" t-value="0"/>
                                            <t t-set="eo" t-value="0"/>
                                            <t t-set="a" t-value="0"/>
                                            <t t-set="po" t-value="0"/>
                                            <t t-set="total_ot" t-value="0"/>
                                            <tr align="center" style="border-style: ridge;">
                                                <td rowspan="3" style="color:black;">
                                                    <t t-esc="emp[3]" style="color:black;"/>
                                                </td>
                                                <td rowspan="3" colspan="3" style="color:black;">
                                                    <t t-esc="emp[4]"/>
                                                </td>
                                                <td rowspan="3" colspan="3" style="color:black;">
                                                    <t t-esc="emp[7]"/>
                                                </td>
                                                <t t-foreach="alldays" t-as="ald">
                                                    <t t-foreach="docs.filtered(lambda x: (x.attDate == ald[0]) and (x.employee_id.id == emp[2]))" t-as="att">
                                                        <t t-set="line_style" t-value="'margin-bottom:0pt;margin-top:0pt;max-height:14pt;'"/>
                                                        <t t-if="att.inFlag == 'A'">
                                                            <t t-set="line_style" t-value="'color:red;'"/>
                                                        </t>
                                                        
                                                        <t t-set="total_ot" t-value="total_ot+att['otHours']"/>
                                                        <t t-if="att.inFlag == 'P'">
                                                            <t t-set="p" t-value="p+1"/>
                                                        </t>
                                                        <t t-if="att.outFlag == 'TO'">
                                                            <t t-set="to" t-value="to+1"/>
                                                        </t>
                                                        <t t-if="att.inFlag == 'L'">
                                                            <t t-set="l" t-value="l+1"/>
                                                        </t>
                                                        <t t-if="att.outFlag == 'EO'">
                                                            <t t-set="eo" t-value="eo+1"/>
                                                        </t>
                                                        <t t-if="att.inFlag == 'A'">
                                                            <t t-set="a" t-value="a+1"/>
                                                        </t>
                                                        <t t-if="att.outFlag == 'PO'">
                                                            <t t-set="po" t-value="po+1"/>
                                                        </t>
                                                        <td style="color:black;">
                                                           <span  t-att-style="line_style" t-esc="att['inFlag']"/>
                                                            <br/>
                                                            <t t-if="(att['inFlag'] != 'A') and (att['inFlag'] != 'H') and (att['inFlag'] != 'F')">
                                                            <span   t-att-style="line_style" t-esc="att['inTime']" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                                            <br/>
                                                            <span  t-att-style="line_style" t-esc="att['inHour']" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                                            </t>
                                                        </td>
                                                        
                                                    </t>
                                                </t>
                                                 <td style="color:black;"><span t-esc="p"/></td>
                                                 <td style="color:black;"><span t-esc="l"/></td>
                                                 <td style="color:black;"><span t-esc="a"/></td>
                                            </tr>
                                            <tr align="center" style="border-style: ridge;">
                                               
                                              <t t-foreach="alldays" t-as="ald">
                                              <t t-foreach="docs.filtered(lambda x: (x.attDate == ald[0]) and (x.employee_id.id == emp[2]))" t-as="att">
                                                <t t-set="line_style" t-value="'margin-bottom:0pt;margin-top:0pt;max-height:14pt;'"/>
                                                <t t-if="att.outFlag == 'A'">
                                                  <t t-set="line_style" t-value="'color:red;'"/>
                                                </t>
                                               <td style="color:black;">
                                                            <span t-att-style="line_style" t-esc="att['outFlag']" t-value="color: Blue"/>
                                                            <br/>
                                                             <t t-if="(att['outFlag'] != 'A') and (att['outFlag'] != 'H') and (att['outFlag'] != 'F')">
                                                            <span  t-att-style="line_style" t-esc="att['outTime']" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                                            <br/>
                                                            <span  t-att-style="line_style" t-esc="att['outHour']" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                                            </t>
                                                </td>
                                                </t>
                                                </t>
                                                
                                                <td style="color:black;"><span t-esc="to"/></td>
                                                <td style="color:black;"><span t-esc="eo"/></td>
                                                <td style="color:black;"><span t-esc="po"/></td>
                                            </tr>
                                            <tr align="center">
                                              <t t-foreach="alldays" t-as="ald">
                                              <t t-foreach="docs.filtered(lambda x: (x.attDate == ald[0]) and (x.employee_id.id == emp[2]))" t-as="att">
                                               <td style="color:black;">
                                                 <t t-if="(att['outFlag'] != 'A') and (att['outFlag'] != 'H') and (att['outFlag'] != 'F')">
                                                <span t-esc="att['otHours']" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                                </t>          
                                                            
                                                </td>
                                                </t>
                                                </t>
                                                <td style="color:black;"><b>Total</b></td>
                                                <td style="color:black;"><b>OT=</b></td>
                                                <td style="color:black;"><span t-esc="total_ot" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/></td>
                                            </tr>
                                            
                                               
                                        </tbody>
                                    </table>
                                </t>
                            </t>
                        </div>
                        <br/>
                        <div class="container">
                      <div class="row justify-content-end" style="font-size:12px;">
                    <p>Section <strong t-esc="se.name" style="color: #cc7000"/> Total Employee : <strong t-esc="total_sec_employee" style="color: #cc7000"/></p>
                      </div>
                    </div>
                    <!--<br/>-->

                    </t>
                    <div class="container">
                      <div class="row justify-content-end" style="font-size:12px;">
                    <p>Department <strong t-esc="dp.name" style="color: #cc7000"/> total Employee : <strong t-esc="total_dep_employee" style="color: #cc7000"/></p>
                      </div>
                    </div>
                   
                    
                </t>
            </div>

        </t>
    </t>
   </template>
</odoo>