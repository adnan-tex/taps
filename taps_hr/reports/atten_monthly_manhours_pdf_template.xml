<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="monthly_manhours_pdf_template">
      <t t-call="web.html_container">
          <t t-call="web.external_layout">
             <div class="page">
               
                <div class="container">
                  
                  <div class="text-center mb-3 mt-3" style="font-size: 16px">
                    <i><strong><span t-esc="month[0]"/> Manhours Report</strong></i>
                
                  </div>
                </div>
                <div class="container">
                
                <table class="table table-sm" style="font-size:10px; table-layout:fixed; page-break-inside: avoid;">
                    <thead style="font-size:7px;">
                        <tr align="center" style="background-color: orange;">
                            <th colspan="3">Section Name</th>
                            <th>Total Worker</th>
                            <th>Total Working Days</th>
                            <th>Total Duty Hours</th>
                            <th>Total OT Hours</th>
                            <th>Total Working Hours</th>
                            <th>Avg. OT Hours(Monthly @Head Count)</th>
                            <th>Avg. OT Hours(Daily @Head Count)</th>
                            <th>Remarks</th>

                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="total_working_days" t-value="0"/>
                        <t t-set="intotal_employee" t-value="0"/>
                        <t t-set="intotal_duty_hours" t-value="0"/>
                        <t t-set="intotal_ot_hours" t-value="0"/>
                        <t t-set="intotal_working_hours" t-value="0"/>
                        <t t-set="intotal_monthly_head_count" t-value="0"/>
                        <t t-set="intotal_daily_head_count" t-value="0"/>
                        <t t-foreach="dpt" t-as="dp">
                            <t t-foreach="sec.filtered(lambda x: (x.parent_id.id == dp.id))" t-as="se">
                                <t t-set="total_employee" t-value="0"/>
                                
                                <!--<t t-set="total_sec_employee" t-value="0"/>-->
                                <t t-set="total_ot_hours" t-value="0"/>
                                <t t-set="total_duty_hours" t-value="0"/>
                                <t t-set="total_working_hours" t-value="0"/>

                                <tr align="center" style="font-size:7px;border: 1pt solid black;border-collapse:separate;">
                                    <td colspan="3">
                                        <span t-esc="se.name" style="font-weight: bold;color: #cc7000"/>
                                    </td>
                                    <t t-foreach="datas" t-as="emp">
                                        <t t-if="emp[9] == se.id">
                                            <t t-set="total_working_days" t-value="0"/>
                                            <t t-set="total_employee" t-value="total_employee+1"/>
      
                                            <t t-foreach="alldays" t-as="ald">
                                               
                                                <t t-foreach="docs.filtered(lambda x: (x.attDate == ald[0]) and (x.employee_id.id == emp[2]))" t-as="att">
                                                    <t t-if="att.attDate != ''">

                                                        <t t-set="total_working_days" t-value="total_working_days+1"/>
                                                    </t>
                                                    <t t-if="att.inFlag == 'P' or att.inFlag == 'L' or att.inFlag == 'HP' or att.inFlag == 'FP'">
                                                        <!--<t t-set="total_sec_employee" t-value="total_sec_employee+1"/>-->
                                                        <t t-set="total_ot_hours" t-value="total_ot_hours+emp[8]"/>
                                                        <t t-set="total_duty_hours" t-value="total_duty_hours+emp[10]"/>
                                                        <t t-set="total_working_hours" t-value="total_working_hours+att.worked_hours"/>
                                                    </t>
                                                </t>
                                            </t>
                                        </t>
                                    </t>
                                    <td>
                                        
                                        <span t-esc="total_employee"/>
                                        <t t-set="intotal_employee" t-value="intotal_employee+total_employee"/>
                                    </td>
                                    <td>
                                        
                                        <span t-esc="total_working_days"/>
                                    </td>
                                    <td>
                                        <span t-esc="total_duty_hours" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                        <t t-set="intotal_duty_hours" t-value="intotal_duty_hours+total_duty_hours"/>
                                    </td>
                                    <td>
                                        <span t-esc="total_ot_hours" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                        <t t-set="intotal_ot_hours" t-value="intotal_ot_hours+total_ot_hours"/>
                                    </td>
                                    <td>
                                        <span t-esc="total_working_hours" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                        <t t-set="intotal_working_hours" t-value="intotal_working_hours+total_working_hours"/>
                                    </td>
                                    <td>
                                        <t t-set="monthly_head_count" t-value="total_ot_hours/total_employee"/>
                                        <span t-esc="monthly_head_count" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                        <t t-set="intotal_monthly_head_count" t-value="intotal_monthly_head_count+intotal_monthly_head_count"/>
                                    </td>
                                    <td>
                                        <span t-esc="monthly_head_count/total_working_days" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/>
                                        <t t-set="intotal_daily_head_count" t-value="intotal_daily_head_count+intotal_monthly_head_count"/>
                                    </td>
                                    <td/>
                                  
                                </tr>

                            </t>
                        </t>
                    </tbody>
                </table>
                <table class="table table-sm" style="font-size:10px; table-layout:fixed; page-break-inside: avoid;">
                  <tr align="center" style="font-weight: bold; background-color: orange;">
                  <td colspan="3">Grand Total</td>
                  <td><span t-esc="intotal_employee"/></td>
                  <td><span t-esc="total_working_days"/></td>
                  <td><span t-esc="intotal_duty_hours" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/></td>
                  <td><span t-esc="intotal_ot_hours" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/></td>
                  <td><span t-esc="intotal_working_hours" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/></td>
                  <td><span t-esc="intotal_monthly_head_count" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/></td>
                  <td><span t-esc="intotal_daily_head_count" t-options="{&quot;widget&quot;: &quot;float_time&quot;}"/></td>
                  <td/>
                  </tr>
                </table>

              </div>
            </div>
          </t>

      </t>
    </template>

</odoo>